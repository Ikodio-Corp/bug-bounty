# Crontab configuration for automated backups and maintenance
# Install with: crontab -e

# Automated daily backup at 2:00 AM
0 2 * * * /app/scripts/backup.sh >> /var/log/ikodio/backup.log 2>&1

# Automated weekly full backup (Sunday at 3:00 AM)
0 3 * * 0 /app/scripts/backup.sh --full >> /var/log/ikodio/backup-full.log 2>&1

# Database maintenance (vacuum) daily at 3:30 AM
30 3 * * * docker-compose exec -T postgres psql -U ikodio -d ikodio_bugbounty -c "VACUUM ANALYZE;" >> /var/log/ikodio/maintenance.log 2>&1

# Cleanup old logs weekly (Sunday at 4:00 AM)
0 4 * * 0 find /var/log/ikodio -name "*.log" -mtime +30 -delete

# Monitor disk space hourly
0 * * * * df -h | grep -E '^/dev/' >> /var/log/ikodio/disk-usage.log

# Health check every 5 minutes
*/5 * * * * curl -f http://localhost:8000/health || echo "Health check failed at $(date)" >> /var/log/ikodio/health-check.log

# Backup verification daily at 5:00 AM
0 5 * * * /app/scripts/verify-backup.sh >> /var/log/ikodio/verify-backup.log 2>&1

# S3 backup sync every 6 hours
0 */6 * * * /app/scripts/s3-sync.sh >> /var/log/ikodio/s3-sync.log 2>&1
